<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Đặt Vé</title>

  <!-- CSS chung -->
  <link rel="stylesheet" href="../../assets/css/Phim.css" />
  <link rel="stylesheet" href="../../assets/css/Booking.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

  <style>
    #include-header { position: relative; z-index: 1000; width: 100%; }

    /* Mặc định không đệm; JS sẽ set đúng padding-top = chiều cao header */
    body.__with-fixed-header {
      padding-top: var(--header-height, 0px);
    }
  </style>
</head>
<body>

  <!-- Header dùng chung -->
<div id="include-header"></div>
<div id="header-spacer" style="height:0"></div>


  <div class="container">
    <div class="header">
      <h1>🎬 Đặt Vé Xem Phim</h1>
      <p>Trải nghiệm điện ảnh tuyệt vời</p>
    </div>

    <div class="main-content">
      <div class="movie-section">
        <div class="movie-info" id="movieInfo">
          <div class="loading">Đang tải thông tin phim...</div>
        </div>
      </div>

      <div class="booking-section">
        <div class="form-group">
          <label for="suatChieu">📅 Chọn suất chiếu:</label>
          <select id="suatChieu">
            <option value="">-- Chọn suất chiếu --</option>
          </select>
        </div>

        <div class="seat-section">
          <label>🪑 Chọn ghế ngồi:</label>
          <div class="screen"></div>
          <div class="seat-grid" id="seatGrid">
            <div class="loading">Chọn suất để hiển thị ghế...</div>
          </div>
          <div class="seat-legend">
            <div class="legend-item">
              <div class="legend-seat legend-available"></div>
              <span>Trống</span>
            </div>
            <div class="legend-item">
              <div class="legend-seat legend-selected"></div>
              <span>Đã chọn</span>
            </div>
            <div class="legend-item">
              <div class="legend-seat legend-booked"></div>
              <span>Đã đặt</span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="bapNuoc">🍿 Chọn bắp nước (không bắt buộc):</label>
          <select id="bapNuoc">
            <option value="">-- Không chọn --</option>
          </select>
        </div>

        <div class="price-info">
          <h3>💰 Tổng tiền</h3>
          <div class="total-price" id="totalPrice">0đ</div>
          <small id="seatPriceInfo"></small>
        </div>

        <button class="btn-book">🎟 Thanh toán ngay</button>
      </div>
    </div>
  </div>

  <!-- Footer dùng chung -->
  <div id="include-footer"></div>

  <!-- Script: cập nhật trạng thái đăng nhập trong header -->
  <script src="../../assets/js/login.js"></script>

  <!-- Helper: nạp header/footer -->
<script>
  function includeHTML(id, file, cb) {
    fetch(file).then(r => r.text()).then(html => {
      document.getElementById(id).innerHTML = html;
      cb && cb();
    }).catch(console.error);
  }

  function adjustHeaderSpacer() {
    const host = document.getElementById('include-header');
    const spacer = document.getElementById('header-spacer');
    if (!host || !spacer) return;

    // phần tử header thật sự (con đầu tiên bên trong include)
    const headerEl = host.firstElementChild || host;

    // đo chính xác chiều cao (kể cả khi position: fixed/sticky)
    const rect = headerEl.getBoundingClientRect();
    const h = Math.max(headerEl.offsetHeight || 0, rect.height || 0);

    spacer.style.height = (Math.ceil(h) || 0) + 'px';
  }

  // re-calc khi đổi kích thước
  window.addEventListener('resize', () => {
    clearTimeout(window.__hdrT);
    window.__hdrT = setTimeout(adjustHeaderSpacer, 100);
  });

  document.addEventListener('DOMContentLoaded', () => {
    includeHTML('include-header', '../../part/header.html', () => {
      // nếu header có script cập nhật đăng nhập
      if (typeof updateAuthButtons === 'function') {
        try { updateAuthButtons(); } catch (e) {}
      }

      // chờ 1 frame để CSS áp xong rồi đo
      requestAnimationFrame(() => {
        adjustHeaderSpacer();

        // Nếu logo/ảnh trong header load chậm, đo lại khi ảnh load
        document.querySelectorAll('#include-header img').forEach(img => {
          if (!img.complete) img.addEventListener('load', adjustHeaderSpacer, { once: true });
        });
      });
    });

    includeHTML('include-footer', '../../part/footer.html');
  });
</script>


  <!-- SignalR client (PHẢI trước booking.js) -->
  <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.5/dist/browser/signalr.min.js"></script>

  <!-- App booking -->
  <script src="../../assets/js/booking.js" defer></script>
</body>
</html>
