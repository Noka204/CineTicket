<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Äáº·t VÃ©</title>

  <!-- CSS chung -->
  <link rel="stylesheet" href="../../assets/css/Phim.css" />
  <link rel="stylesheet" href="../../assets/css/Booking.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

  <style>
    #include-header { position: relative; z-index: 1000; width: 100%; }

    /* Máº·c Ä‘á»‹nh khÃ´ng Ä‘á»‡m; JS sáº½ set Ä‘Ãºng padding-top = chiá»u cao header */
    body.__with-fixed-header {
      padding-top: var(--header-height, 0px);
    }
  </style>
</head>
<body>

  <!-- Header dÃ¹ng chung -->
<div id="include-header"></div>
<div id="header-spacer" style="height:0"></div>


  <div class="container">
    <div class="header">
      <h1>ğŸ¬ Äáº·t VÃ© Xem Phim</h1>
      <p>Tráº£i nghiá»‡m Ä‘iá»‡n áº£nh tuyá»‡t vá»i</p>
    </div>

    <div class="main-content">
      <div class="movie-section">
        <div class="movie-info" id="movieInfo">
          <div class="loading">Äang táº£i thÃ´ng tin phim...</div>
        </div>
      </div>

      <div class="booking-section">
        <div class="form-group">
          <label for="suatChieu">ğŸ“… Chá»n suáº¥t chiáº¿u:</label>
          <select id="suatChieu">
            <option value="">-- Chá»n suáº¥t chiáº¿u --</option>
          </select>
        </div>

        <div class="seat-section">
          <label>ğŸª‘ Chá»n gháº¿ ngá»“i:</label>
          <div class="screen"></div>
          <div class="seat-grid" id="seatGrid">
            <div class="loading">Chá»n suáº¥t Ä‘á»ƒ hiá»ƒn thá»‹ gháº¿...</div>
          </div>
          <div class="seat-legend">
            <div class="legend-item">
              <div class="legend-seat legend-available"></div>
              <span>Trá»‘ng</span>
            </div>
            <div class="legend-item">
              <div class="legend-seat legend-selected"></div>
              <span>ÄÃ£ chá»n</span>
            </div>
            <div class="legend-item">
              <div class="legend-seat legend-booked"></div>
              <span>ÄÃ£ Ä‘áº·t</span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="bapNuoc">ğŸ¿ Chá»n báº¯p nÆ°á»›c (khÃ´ng báº¯t buá»™c):</label>
          <select id="bapNuoc">
            <option value="">-- KhÃ´ng chá»n --</option>
          </select>
        </div>

        <div class="price-info">
          <h3>ğŸ’° Tá»•ng tiá»n</h3>
          <div class="total-price" id="totalPrice">0Ä‘</div>
          <small id="seatPriceInfo"></small>
        </div>

        <button class="btn-book">ğŸŸ Thanh toÃ¡n ngay</button>
      </div>
    </div>
  </div>

  <!-- Footer dÃ¹ng chung -->
  <div id="include-footer"></div>

  <!-- Script: cáº­p nháº­t tráº¡ng thÃ¡i Ä‘Äƒng nháº­p trong header -->
  <script src="../../assets/js/login.js"></script>

  <!-- Helper: náº¡p header/footer -->
<script>
  function includeHTML(id, file, cb) {
    fetch(file).then(r => r.text()).then(html => {
      document.getElementById(id).innerHTML = html;
      cb && cb();
    }).catch(console.error);
  }

  function adjustHeaderSpacer() {
    const host = document.getElementById('include-header');
    const spacer = document.getElementById('header-spacer');
    if (!host || !spacer) return;

    // pháº§n tá»­ header tháº­t sá»± (con Ä‘áº§u tiÃªn bÃªn trong include)
    const headerEl = host.firstElementChild || host;

    // Ä‘o chÃ­nh xÃ¡c chiá»u cao (ká»ƒ cáº£ khi position: fixed/sticky)
    const rect = headerEl.getBoundingClientRect();
    const h = Math.max(headerEl.offsetHeight || 0, rect.height || 0);

    spacer.style.height = (Math.ceil(h) || 0) + 'px';
  }

  // re-calc khi Ä‘á»•i kÃ­ch thÆ°á»›c
  window.addEventListener('resize', () => {
    clearTimeout(window.__hdrT);
    window.__hdrT = setTimeout(adjustHeaderSpacer, 100);
  });

  document.addEventListener('DOMContentLoaded', () => {
    includeHTML('include-header', '../../part/header.html', () => {
      // náº¿u header cÃ³ script cáº­p nháº­t Ä‘Äƒng nháº­p
      if (typeof updateAuthButtons === 'function') {
        try { updateAuthButtons(); } catch (e) {}
      }

      // chá» 1 frame Ä‘á»ƒ CSS Ã¡p xong rá»“i Ä‘o
      requestAnimationFrame(() => {
        adjustHeaderSpacer();

        // Náº¿u logo/áº£nh trong header load cháº­m, Ä‘o láº¡i khi áº£nh load
        document.querySelectorAll('#include-header img').forEach(img => {
          if (!img.complete) img.addEventListener('load', adjustHeaderSpacer, { once: true });
        });
      });
    });

    includeHTML('include-footer', '../../part/footer.html');
  });
</script>


  <!-- SignalR client (PHáº¢I trÆ°á»›c booking.js) -->
  <script src="https://cdn.jsdelivr.net/npm/@microsoft/signalr@8.0.5/dist/browser/signalr.min.js"></script>

  <!-- App booking -->
  <script src="../../assets/js/booking.js" defer></script>
</body>
</html>
